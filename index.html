<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Племя Древних</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: 'Arial', sans-serif;
            background: #1a5c2d;
            color: #fff;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .game-container {
            display: flex;
            gap: 20px;
            margin-top: 20px;
        }
        
        #gameCanvas {
            background: #7cae7a;
            border: 3px solid #5a8158;
            border-radius: 5px;
        }
        
        .ui-panel {
            background: rgba(69, 97, 60, 0.8);
            border-radius: 8px;
            padding: 15px;
            width: 250px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
        }
        
        h1 {
            color: #f5d547;
            text-shadow: 2px 2px 0 #000;
            margin-bottom: 10px;
        }
        
        h2 {
            color: #f5d547;
            border-bottom: 2px solid #f5d547;
            padding-bottom: 5px;
        }
        
        .resource {
            display: flex;
            justify-content: space-between;
            margin: 8px 0;
            padding: 5px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
        }
        
        .villager {
            margin: 10px 0;
            padding: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
        }
        
        button {
            background: #f5d547;
            color: #333;
            border: none;
            padding: 8px 15px;
            border-radius: 4px;
            margin: 5px 0;
            cursor: pointer;
            font-weight: bold;
            width: 100%;
        }
        
        button:hover {
            background: #e6c63d;
        }
        
        .progress-bar {
            height: 10px;
            background: #444;
            border-radius: 5px;
            margin: 5px 0;
        }
        
        .progress-fill {
            height: 100%;
            border-radius: 5px;
        }
        
        .health { background: #e74c3c; }
        .food { background: #2ecc71; }
        .energy { background: #3498db; }
        
        .time-display {
            text-align: center;
            font-size: 18px;
            margin: 10px 0;
            padding: 5px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 5px;
        }
        
        .stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 15px;
        }
        
        .stat {
            background: rgba(0, 0, 0, 0.2);
            padding: 8px;
            border-radius: 4px;
            text-align: center;
        }
    </style>
</head>
<body>
    <h1>Племя Древних</h1>
    <p>Управляйте своим поселением, чтобы помочь древним людям выжить</p>
    
    <div class="game-container">
        <canvas id="gameCanvas" width="800" height="600"></canvas>
        
        <div class="ui-panel">
            <h2>Ресурсы</h2>
            <div class="resource">
                <span>Еда:</span>
                <span id="foodCount">50</span>
            </div>
            <div class="resource">
                <span>Дерево:</span>
                <span id="woodCount">30</span>
            </div>
            <div class="resource">
                <span>Камень:</span>
                <span id="stoneCount">15</span>
            </div>
            <div class="resource">
                <span>Кожи:</span>
                <span id="hideCount">5</span>
            </div>
            
            <h2>Поселенцы</h2>
            <div id="villagersList">
                <!-- Сюда будут добавляться поселенцы -->
            </div>
            
            <h2>Действия</h2>
            <button id="addVillagerBtn">Новый поселенец (50 еды)</button>
            <button id="buildHutBtn">Построить хижину (30 дерева)</button>
            <button id="gatherFoodBtn">Собирать еду</button>
            <button id="gatherWoodBtn">Собирать дерево</button>
            
            <div class="stats">
                <div class="stat">
                    <div>День</div>
                    <div id="dayCount">1</div>
                </div>
                <div class="stat">
                    <div>Население</div>
                    <div id="populationCount">3</div>
                </div>
            </div>
            
            <div class="time-display">
                <div id="timeOfDay">День</div>
                <div id="season">Весна</div>
            </div>
        </div>
    </div>

    <script>
        // Основные переменные игры
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        
        // Состояние игры
        const gameState = {
            resources: {
                food: 50,
                wood: 30,
                stone: 15,
                hide: 5
            },
            villagers: [],
            buildings: [],
            day: 1,
            time: 0, // 0-1, где 0 - полночь, 0.5 - полдень
            season: 0, // 0-весна, 1-лето, 2-осень, 3-зима
            selectedVillager: null,
            gameSpeed: 1
        };
        
        // Класс поселенца
        class Villager {
            constructor() {
                this.id = Math.random().toString(36).substr(2, 9);
                this.x = Math.random() * canvas.width;
                this.y = Math.random() * canvas.height;
                this.size = 20;
                this.color = `hsl(${Math.random() * 360}, 70%, 60%)`;
                this.speed = 1 + Math.random() * 0.5;
                this.target = null;
                this.task = 'idle';
                this.health = 100;
                this.food = 100;
                this.energy = 100;
                this.carrying = null;
                this.carryAmount = 0;
            }
            
            update() {
                // Двигаться к цели, если она есть
                if (this.target) {
                    const dx = this.target.x - this.x;
                    const dy = this.target.y - this.y;
                    const dist = Math.sqrt(dx * dx + dy * dy);
                    
                    if (dist > 5) {
                        this.x += (dx / dist) * this.speed;
                        this.y += (dy / dist) * this.speed;
                    } else {
                        // Достигли цели
                        if (this.task === 'gatherFood') {
                            this.carrying = 'food';
                            this.carryAmount = 5;
                            this.target = { x: Math.random() * canvas.width, y: Math.random() * canvas.height };
                            this.task = 'returnFood';
                        } else if (this.task === 'returnFood') {
                            gameState.resources.food += this.carryAmount;
                            this.carrying = null;
                            this.carryAmount = 0;
                            this.findTask();
                        } else if (this.task === 'gatherWood') {
                            this.carrying = 'wood';
                            this.carryAmount = 3;
                            this.target = { x: Math.random() * canvas.width, y: Math.random() * canvas.height };
                            this.task = 'returnWood';
                        } else if (this.task === 'returnWood') {
                            gameState.resources.wood += this.carryAmount;
                            this.carrying = null;
                            this.carryAmount = 0;
                            this.findTask();
                        }
                    }
                } else {
                    // Без цели, ищем задачу
                    this.findTask();
                }
                
                // Уменьшение показателей со временем
                this.food -= 0.02;
                this.energy -= 0.01;
                
                // Если еда на нуле, уменьшается здоровье
                if (this.food <= 0) {
                    this.health -= 0.05;
                    this.food = 0;
                }
                
                // Если энергия на нуле, уменьшается скорость
                if (this.energy <= 0) {
                    this.speed = 0.5;
                    this.energy = 0;
                } else {
                    this.speed = 1 + Math.random() * 0.5;
                }
                
                // Проверка на смерть
                if (this.health <= 0) {
                    this.health = 0;
                    // Удаляем этого поселенца
                    const index = gameState.villagers.findIndex(v => v.id === this.id);
                    if (index !== -1) {
                        gameState.villagers.splice(index, 1);
                    }
                }
            }
            
            findTask() {
                // Простой ИИ для выбора задачи
                if (this.food < 30) {
                    // Если голоден, ищет еду
                    this.task = 'eat';
                    this.target = { x: Math.random() * canvas.width, y: Math.random() * canvas.height };
                } else if (this.energy < 30) {
                    // Если устал, "отдыхает"
                    this.task = 'rest';
                    this.energy += 0.5;
                } else {
                    // Иначе выполняет общую задачу
                    if (gameState.resources.food < 50) {
                        this.task = 'gatherFood';
                        this.target = { x: Math.random() * canvas.width, y: Math.random() * canvas.height };
                    } else if (gameState.resources.wood < 40) {
                        this.task = 'gatherWood';
                        this.target = { x: Math.random() * canvas.width, y: Math.random() * canvas.height };
                    } else {
                        this.task = 'idle';
                        this.target = { x: Math.random() * canvas.width, y: Math.random() * canvas.height };
                    }
                }
            }
            
            draw() {
                // Рисуем поселенца
                ctx.fillStyle = this.color;
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                ctx.fill();
                
                // Рисуем индикатор задачи
                ctx.fillStyle = 'white';
                ctx.font = '12px Arial';
                ctx.fillText(this.task, this.x - 15, this.y - 25);
                
                // Рисуем индикатор здоровья
                ctx.fillStyle = 'red';
                ctx.fillRect(this.x - 15, this.y - 30, 30, 5);
                ctx.fillStyle = 'green';
                ctx.fillRect(this.x - 15, this.y - 30, 30 * (this.health / 100), 5);
            }
        }
        
        // Инициализация игры
        function initGame() {
            // Создаем начальных поселенцев
            for (let i = 0; i < 3; i++) {
                gameState.villagers.push(new Villager());
            }
            
            // Запускаем игровой цикл
            gameLoop();
            
            // Обновляем интерфейс каждые 500ms
            setInterval(updateUI, 500);
        }
        
        // Игровой цикл
        function gameLoop() {
            // Очищаем canvas
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Рисуем фон в зависимости от времени суток
            drawBackground();
            
            // Обновляем и рисуем поселенцев
            gameState.villagers.forEach(villager => {
                villager.update();
                villager.draw();
            });
            
            // Обновляем время
            gameState.time += 0.001 * gameState.gameSpeed;
            if (gameState.time >= 1) {
                gameState.time = 0;
                gameState.day++;
                
                // Каждый день потребляется еда
                const foodConsumption = gameState.villagers.length * 5;
                gameState.resources.food -= foodConsumption;
                if (gameState.resources.food < 0) gameState.resources.food = 0;
                
                // Каждые 10 дней смена сезона
                if (gameState.day % 10 === 0) {
                    gameState.season = (gameState.season + 1) % 4;
                }
            }
            
            // Проверяем условия победы/поражения
            if (gameState.villagers.length === 0) {
                ctx.fillStyle = 'rgba(0, 0, 0, 0.7)';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                ctx.fillStyle = 'white';
                ctx.font = '48px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('Племя вымерло!', canvas.width / 2, canvas.height / 2);
                ctx.font = '24px Arial';
                ctx.fillText(`Вы прожили ${gameState.day} дней`, canvas.width / 2, canvas.height / 2 + 50);
                return;
            }
            
            if (gameState.villagers.length >= 20) {
                ctx.fillStyle = 'rgba(0, 0, 0, 0.7)';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                ctx.fillStyle = 'white';
                ctx.font = '48px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('Победа!', canvas.width / 2, canvas.height / 2);
                ctx.font = '24px Arial';
                ctx.fillText('Ваше племя процветает!', canvas.width / 2, canvas.height / 2 + 50);
                return;
            }
            
            requestAnimationFrame(gameLoop);
        }
        
        // Функция отрисовки фона
        function drawBackground() {
            // Рисуем небо в зависимости от времени суток
            const time = gameState.time;
            let skyColor;
            
            if (time < 0.25) {
                // Ночь
                skyColor = '#0c1445';
            } else if (time < 0.5) {
                // Утро
                const progress = (time - 0.25) * 4;
                skyColor = `rgb(${12 + progress * 100}, ${20 + progress * 120}, ${69 + progress * 60})`;
            } else if (time < 0.75) {
                // День
                skyColor = '#87ceeb';
            } else {
                // Вечер
                const progress = (time - 0.75) * 4;
                skyColor = `rgb(${135 - progress * 50}, ${135 - progress * 50}, ${235 - progress * 100})`;
            }
            
            ctx.fillStyle = skyColor;
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // Рисуем землю
            ctx.fillStyle = '#5a3c1e';
            ctx.fillRect(0, canvas.height - 100, canvas.width, 100);
            
            // Рисуем траву
            ctx.fillStyle = '#3c6b30';
            ctx.fillRect(0, canvas.height - 100, canvas.width, 20);
            
            // Рисуем ресурсы (упрощенно)
            ctx.fillStyle = '#8b5a2b';
            for (let i = 0; i < 10; i++) {
                ctx.beginPath();
                ctx.arc(100 + i * 70, canvas.height - 80, 10, 0, Math.PI * 2);
                ctx.fill();
                ctx.fillText('Дерево', 100 + i * 70 - 15, canvas.height - 95);
            }
            
            // Рисуем солнце/луну
            ctx.fillStyle = time < 0.25 || time > 0.75 ? '#ffffff' : '#ffde37';
            const celestialX = canvas.width * time;
            const celestialY = 100 + Math.sin(time * Math.PI * 2) * 50;
            ctx.beginPath();
            ctx.arc(celestialX, celestialY, 30, 0, Math.PI * 2);
            ctx.fill();
        }
        
        // Обновление интерфейса
        function updateUI() {
            // Обновляем ресурсы
            document.getElementById('foodCount').textContent = Math.floor(gameState.resources.food);
            document.getElementById('woodCount').textContent = Math.floor(gameState.resources.wood);
            document.getElementById('stoneCount').textContent = Math.floor(gameState.resources.stone);
            document.getElementById('hideCount').textContent = Math.floor(gameState.resources.hide);
            
            // Обновляем счетчики
            document.getElementById('dayCount').textContent = gameState.day;
            document.getElementById('populationCount').textContent = gameState.villagers.length;
            
            // Обновляем время суток и сезон
            const time = gameState.time;
            let timeOfDay;
            if (time < 0.25) timeOfDay = "Ночь";
            else if (time < 0.5) timeOfDay = "Утро";
            else if (time < 0.75) timeOfDay = "День";
            else timeOfDay = "Вечер";
            
            const seasons = ["Весна", "Лето", "Осень", "Зима"];
            document.getElementById('timeOfDay').textContent = timeOfDay;
            document.getElementById('season').textContent = seasons[gameState.season];
            
            // Обновляем список поселенцев
            const villagersList = document.getElementById('villagersList');
            villagersList.innerHTML = '';
            
            gameState.villagers.forEach(villager => {
                const villagerEl = document.createElement('div');
                villagerEl.className = 'villager';
                villagerEl.innerHTML = `
                    <div>Поселенец (${villager.task})</div>
                    <div class="progress-bar">
                        <div class="progress-fill health" style="width: ${villager.health}%"></div>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill food" style="width: ${villager.food}%"></div>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill energy" style="width: ${villager.energy}%"></div>
                    </div>
                `;
                villagersList.appendChild(villagerEl);
            });
        }
        
        // Обработчики событий
        document.getElementById('addVillagerBtn').addEventListener('click', () => {
            if (gameState.resources.food >= 50) {
                gameState.resources.food -= 50;
                gameState.villagers.push(new Villager());
            }
        });
        
        document.getElementById('buildHutBtn').addEventListener('click', () => {
            if (gameState.resources.wood >= 30) {
                gameState.resources.wood -= 30;
                // Увеличиваем максимальное население или даем другую пользу
                alert('Хижина построена! Теперь ваше племя может увеличиться.');
            }
        });
        
        document.getElementById('gatherFoodBtn').addEventListener('click', () => {
            gameState.villagers.forEach(villager => {
                villager.task = 'gatherFood';
                villager.target = { x: Math.random() * canvas.width, y: Math.random() * canvas.height };
            });
        });
        
        document.getElementById('gatherWoodBtn').addEventListener('click', () => {
            gameState.villagers.forEach(villager => {
                villager.task = 'gatherWood';
                villager.target = { x: Math.random() * canvas.width, y: Math.random() * canvas.height };
            });
        });
        
        // Запускаем игру при загрузке
        window.onload = initGame;
    </script>
</body>
</html>
